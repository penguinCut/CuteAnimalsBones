var popping = false;

window.addEventListener('popstate', function (event) {
  popping = true;
});

var FadeTransition = Barba.BaseTransition.extend({
  start: function() {
    /**
     * This function is automatically called as soon the Transition starts
     * this.newContainerLoading is a Promise for the loading of the new
     * container (Barba.js also comes with an handy Promise polyfill!)
     */

    // As soon the loading is finished and the old page is faded out, let's
    // animate the new page
    Promise
      .all([this.newContainerLoading, this.fadeOut()])
      .then(this.fadeIn.bind(this));
  },

  fadeOut: function() {
    /**
     * this.oldContainer is the HTMLElement of the old Container
     */

    var $layers = jQuery('' +
      '<div class="js-revealer anim--effect-1">' +
        '<div class="revealer revealer--bottom revealer--animate">' +
          '<div class="revealer__layer">' +
            '<svg class="revealer__svg" version="1.1" xmlns="http://www.w3.org/2000/svg" x="0" y="0" viewBox="0 0 270 16" xml:space="preserve"><polygon points="13.7 2.1 13.7 4.5 8.7 4.5 8.7 13.9 6 13.9 6 4.5 1 4.5 1 2.1 "/><path d="M20.6 7.5c0-0.2 0-0.4 0.1-0.5 0.1-0.2 0.2-0.3 0.3-0.5 0.1-0.1 0.3-0.2 0.5-0.3C22 6 22.6 6.1 23 6.5c0.1 0.1 0.2 0.3 0.3 0.4 0.1 0.4 0.1 0.7 0 1.1 -0.1 0.3-0.4 0.6-0.8 0.8 -0.4 0.1-0.7 0.1-1.1 0 -0.2-0.1-0.3-0.2-0.4-0.3 -0.1-0.1-0.2-0.3-0.3-0.4C20.6 7.9 20.6 7.7 20.6 7.5"/><polygon points="41.8 6.8 41.8 9.1 33.5 9.1 33.5 11.5 42.2 11.5 42.2 13.9 30.7 13.9 30.7 2.1 42.1 2.1 42.1 4.5 33.5 4.5 33.5 6.8 "/><path d="M49.4 7.5c0-0.2 0-0.4 0.1-0.5 0.1-0.2 0.2-0.3 0.3-0.4 0.1-0.1 0.3-0.2 0.5-0.3 0.5-0.2 1.1-0.1 1.5 0.3C51.9 6.7 52 6.8 52.1 7c0.1 0.4 0.1 0.7 0 1.1 -0.1 0.3-0.4 0.6-0.8 0.8C51 9 50.6 9 50.2 8.8c-0.2-0.1-0.3-0.2-0.5-0.3 -0.1-0.1-0.2-0.3-0.3-0.4C49.4 7.9 49.4 7.7 49.4 7.5M59.5 13.9V2.1h7.7c0.7 0 1.4 0.1 2.1 0.3 0.5 0.2 1 0.5 1.4 0.9 0.4 0.4 0.7 0.8 0.8 1.3 0.2 0.5 0.3 1 0.3 1.5 0 0.8-0.2 1.5-0.6 2.1 -0.5 0.6-1.1 1-1.8 1.2l2.6 4.4h-3l-2.3-4h-4.4v4H59.5zM62.3 4.5v3.2h5c0.3 0 0.6 0 0.9-0.1 0.2-0.1 0.4-0.2 0.6-0.3 0.1-0.1 0.2-0.3 0.3-0.5 0.1-0.4 0.1-0.8 0-1.2 -0.1-0.2-0.2-0.4-0.3-0.5 -0.2-0.2-0.4-0.3-0.6-0.3 -0.3-0.1-0.6-0.1-0.9-0.1L62.3 4.5 62.3 4.5zM79 7.5c0-0.2 0-0.4 0.1-0.5 0.1-0.2 0.2-0.3 0.3-0.4 0.1-0.1 0.3-0.2 0.4-0.3 0.7-0.3 1.6 0 1.9 0.8 0.3 0.7 0 1.6-0.8 1.9 -0.4 0.1-0.7 0.1-1.1 0 -0.2-0.1-0.3-0.2-0.4-0.3 -0.1-0.1-0.2-0.3-0.3-0.4C79 7.9 79 7.7 79 7.5M89.1 13.9V2.1h7.7c0.7 0 1.4 0.1 2.1 0.3 0.5 0.2 1 0.5 1.4 0.9 0.4 0.4 0.7 0.8 0.8 1.3 0.2 0.5 0.3 1 0.3 1.5 0 0.8-0.2 1.5-0.6 2.1 -0.5 0.6-1.1 1-1.8 1.2l2.6 4.4h-3l-2.3-4h-4.4v4C91.8 13.9 89.1 13.9 89.1 13.9zM91.8 4.5v3.2h5c0.3 0 0.6 0 0.9-0.1 0.2-0.1 0.4-0.2 0.6-0.3 0.1-0.1 0.2-0.3 0.3-0.5 0.1-0.4 0.1-0.8 0-1.2 -0.1-0.2-0.2-0.4-0.3-0.5 -0.2-0.2-0.4-0.3-0.6-0.3 -0.3-0.1-0.6-0.1-0.9-0.1L91.8 4.5 91.8 4.5zM108.5 7.5c0-0.2 0-0.4 0.1-0.5 0.1-0.2 0.2-0.3 0.3-0.4 0.6-0.6 1.5-0.5 2 0 0.1 0.1 0.2 0.3 0.3 0.4 0.1 0.4 0.1 0.7 0 1.1 -0.3 0.7-1.1 1.1-1.9 0.7 -0.2-0.1-0.3-0.2-0.4-0.3 -0.1-0.1-0.2-0.3-0.3-0.4C108.6 7.9 108.5 7.7 108.5 7.5M128.8 11.6h-6.7l-1.2 2.3H118l6.3-11.7h2.2l6.4 11.7H130L128.8 11.6zM123.3 9.3h4.2l-2.1-3.9L123.3 9.3zM139.5 7.5c0-0.2 0-0.4 0.1-0.5 0.1-0.2 0.2-0.3 0.3-0.4 0.4-0.4 1-0.5 1.6-0.3 0.2 0.1 0.3 0.2 0.4 0.3 0.1 0.1 0.2 0.3 0.3 0.4 0.1 0.4 0.1 0.7 0 1.1 -0.1 0.2-0.2 0.3-0.3 0.4 -0.4 0.4-1 0.5-1.6 0.3 -0.2-0.1-0.3-0.2-0.4-0.3 -0.1-0.1-0.2-0.3-0.3-0.4C139.5 7.9 139.5 7.7 139.5 7.5M149.6 13.9V2.1h7.5c0.5 0 1.1 0 1.6 0.1 0.4 0.1 0.8 0.2 1.2 0.3 0.3 0.1 0.6 0.3 0.8 0.5 0.2 0.2 0.4 0.4 0.5 0.6 0.1 0.2 0.2 0.5 0.3 0.7 0 0.3 0.1 0.5 0.1 0.8 0 0.3 0 0.6-0.1 0.9 -0.1 0.3-0.2 0.5-0.4 0.7 -0.2 0.2-0.4 0.4-0.6 0.5 -0.2 0.1-0.5 0.3-0.8 0.3 0.6 0.1 1.2 0.4 1.7 0.9 0.4 0.5 0.6 1.1 0.6 1.7 0 0.3 0 0.6-0.1 0.8 -0.1 0.3-0.2 0.6-0.3 0.8 -0.2 0.3-0.3 0.5-0.6 0.7 -0.3 0.2-0.6 0.4-0.9 0.6 -0.4 0.2-0.8 0.3-1.2 0.4 -0.5 0.1-1.1 0.2-1.6 0.1L149.6 13.9 149.6 13.9zM157.2 6.7c0.3 0 0.5 0 0.8-0.1 0.2 0 0.4-0.1 0.5-0.2 0.1-0.1 0.2-0.2 0.3-0.4 0.1-0.1 0.1-0.3 0.1-0.5 0-0.2 0-0.3-0.1-0.5 -0.1-0.1-0.1-0.3-0.3-0.4 -0.1-0.1-0.3-0.2-0.5-0.2 -0.3-0.1-0.5-0.1-0.8-0.1h-4.8v2.4H157.2L157.2 6.7zM157.2 11.6c0.3 0 0.7 0 1-0.1 0.2 0 0.4-0.1 0.6-0.2 0.1-0.1 0.3-0.2 0.3-0.4 0.1-0.4 0.1-0.8 0-1.1 -0.1-0.2-0.2-0.3-0.3-0.4 -0.2-0.1-0.4-0.2-0.6-0.3 -0.3-0.1-0.7-0.1-1-0.1h-4.8v2.6L157.2 11.6 157.2 11.6zM169 7.5c0-0.2 0-0.4 0.1-0.5 0.1-0.2 0.2-0.3 0.3-0.4 0.1-0.1 0.3-0.2 0.4-0.3 0.5-0.2 1.1-0.1 1.6 0.3 0.1 0.1 0.2 0.3 0.3 0.4 0.1 0.4 0.1 0.7 0 1.1 -0.1 0.3-0.4 0.6-0.8 0.8 -0.4 0.1-0.7 0.1-1.1 0 -0.2-0.1-0.3-0.2-0.4-0.3 -0.1-0.1-0.2-0.3-0.3-0.4C169 7.9 169 7.7 169 7.5"/><rect x="179.1" y="2.1" width="2.7" height="11.7"/><path d="M189.2 7.5c0-0.2 0-0.4 0.1-0.5 0.1-0.2 0.2-0.3 0.3-0.4 0.1-0.1 0.3-0.2 0.4-0.3 0.7-0.2 1.5 0.2 1.8 0.9s-0.2 1.5-0.9 1.8c-0.1 0-0.2 0-0.3 0.1 -0.2 0-0.4 0-0.6-0.1 -0.2-0.1-0.3-0.2-0.4-0.3 -0.1-0.1-0.2-0.3-0.3-0.4C189.2 8 189.2 7.8 189.2 7.5"/><polygon points="211.7 2.1 211.7 4.5 206.6 4.5 206.6 13.9 203.9 13.9 203.9 4.5 198.9 4.5 198.9 2.1 "/><path d="M218.5 7.5c0-0.2 0-0.4 0.1-0.5 0.1-0.2 0.2-0.3 0.3-0.4 0.4-0.4 1-0.5 1.6-0.3 0.2 0.1 0.3 0.2 0.4 0.3 0.1 0.1 0.2 0.3 0.3 0.4 0.1 0.4 0.1 0.7 0 1.1 -0.1 0.2-0.2 0.3-0.3 0.4 -0.4 0.4-1 0.5-1.6 0.3 -0.2-0.1-0.3-0.2-0.4-0.3 -0.1-0.1-0.2-0.3-0.3-0.4C218.5 7.9 218.5 7.7 218.5 7.5"/><polygon points="239.7 6.8 239.7 9.1 231.4 9.1 231.4 11.5 240.1 11.5 240.1 13.9 228.6 13.9 228.6 2.1 240.1 2.1 240.1 4.5 231.4 4.5 231.4 6.8 "/><path d="M247.3 7.5c0-0.2 0-0.4 0.1-0.5 0.1-0.2 0.2-0.3 0.3-0.4 0.1-0.1 0.3-0.2 0.4-0.3 0.7-0.3 1.5 0 1.9 0.7 0.2 0.5 0.1 1.2-0.3 1.6 -0.4 0.4-1 0.5-1.6 0.3 -0.2-0.1-0.3-0.2-0.4-0.3 -0.1-0.1-0.2-0.3-0.3-0.4C247.3 7.9 247.3 7.7 247.3 7.5M267.4 4.9c-0.4-0.2-0.8-0.3-1.1-0.4 -0.4-0.1-0.8-0.2-1.4-0.3 -0.6-0.1-1.2-0.1-1.8-0.1 -0.4 0-0.9 0-1.3 0.1 -0.3 0-0.6 0.1-0.9 0.2 -0.2 0.1-0.4 0.2-0.5 0.3 -0.1 0.1-0.2 0.3-0.2 0.5 0 0.2 0.1 0.4 0.2 0.5 0.2 0.2 0.4 0.3 0.6 0.4 0.3 0.1 0.7 0.2 1 0.3l1.4 0.3c0.9 0.2 1.8 0.4 2.5 0.6 0.6 0.2 1.2 0.4 1.8 0.8 0.4 0.2 0.8 0.6 1 1 0.2 0.4 0.4 0.9 0.3 1.4 0 0.5-0.1 1.1-0.4 1.6 -0.3 0.5-0.7 0.9-1.2 1.1 -0.6 0.3-1.2 0.6-1.9 0.7 -0.8 0.2-1.7 0.2-2.5 0.2 -0.5 0-1 0-1.5-0.1s-0.8-0.1-1.2-0.1 -0.7-0.1-1-0.2 -0.6-0.2-0.9-0.3c-0.5-0.2-1-0.4-1.5-0.7l1.3-1.9c0.4 0.2 0.8 0.4 1.3 0.5 0.5 0.1 1 0.2 1.5 0.3 0.7 0.1 1.3 0.2 2 0.1 0.8 0 1.7-0.1 2.5-0.3 0.4-0.1 0.8-0.5 0.8-0.9 0-0.2 0-0.3-0.2-0.5 -0.2-0.2-0.3-0.3-0.6-0.3 -0.3-0.1-0.7-0.2-1-0.3L263 9.2c-0.9-0.2-1.7-0.4-2.6-0.7 -0.6-0.2-1.2-0.5-1.7-0.8 -0.4-0.3-0.7-0.6-0.9-1 -0.2-0.4-0.3-0.9-0.3-1.3 0-0.4 0.1-0.9 0.3-1.3 0.2-0.4 0.5-0.8 0.9-1.1 0.5-0.4 1.1-0.6 1.7-0.8 0.8-0.2 1.7-0.3 2.5-0.3 0.9 0 1.7 0.1 2.6 0.2 0.6 0.1 1.2 0.2 1.8 0.4 0.5 0.1 0.9 0.3 1.3 0.6L267.4 4.9z"/></svg>' +
          '</div>' +
        '</div>' +
      '</div>'
    );

    // find hex color, add inline style
    var sitePager = jQuery(this.oldContainer).find('.site-pager');
    if(sitePager.length) {
      var hexColor = sitePager.data('hex');
      $layers.find('.revealer').addClass('revealer--light');
      $layers.find('.revealer__layer').css({'backgroundColor':'#'+hexColor});
    }
    else {
      if(currentUrl === base_path) {
        var targetUrl = Barba.HistoryManager.currentStatus().url.split('/');
        targetUrl = targetUrl[targetUrl.length - 1];
        var link = jQuery(this.oldContainer).find('.js-fullpage-link[href="/' + targetUrl + '"]');
        hexColor = link.data('hex-color');
        if(hexColor !== 'E3D9BF') {
          $layers.find('.revealer').addClass('revealer--light');
        }
        $layers.find('.revealer__layer').css({'backgroundColor':'#'+hexColor});
      }
    }
    jQuery('body').append($layers);
    return jQuery(this.oldContainer).animate({ opacity: 0 }).promise();
  },

  fadeIn: function() {
    /**
     * this.newContainer is the HTMLElement of the new Container
     * At this stage newContainer is on the DOM (inside our #barba-container and with visibility: hidden)
     * Please note, newContainer is available just after newContainerLoading is resolved!
     */
    // $(window).scrollTop(0); // scroll to top here
    jQuery('html, body').animate({
      scrollTop: 0
    }, 0);

    var _this = this;
    var $el = jQuery(this.newContainer);

    jQuery(this.oldContainer).hide();

    $el.css({
      visibility : 'visible',
      opacity : 0
    });

    Drupal.detachBehaviors(this.oldContainer);

    $el.animate({ opacity: 1 }, 1400, function() {
      /**
       * Do not forget to call .done() as soon your transition is finished!
       * .done() will automatically remove from the DOM the old Container
       */
      _this.done();
      Drupal.attachBehaviors(this.newContainer);
      jQuery('.js-revealer').remove();
    });
  }
});

var FrontTransition = this.FadeTransition.extend({
  fadeOut: function() {
    /**
     * this.oldContainer is the HTMLElement of the old Container
     */
    var $layers = jQuery('' +
      '<div class="js-revealer anim--effect-1">' +
      '<div class="revealer revealer--bottom revealer--animate">' +
      '<div class="revealer__layer">' +
      '<svg class="revealer__svg" version="1.1" xmlns="http://www.w3.org/2000/svg" x="0" y="0" viewBox="0 0 270 16" xml:space="preserve"><polygon points="13.7 2.1 13.7 4.5 8.7 4.5 8.7 13.9 6 13.9 6 4.5 1 4.5 1 2.1 "/><path d="M20.6 7.5c0-0.2 0-0.4 0.1-0.5 0.1-0.2 0.2-0.3 0.3-0.5 0.1-0.1 0.3-0.2 0.5-0.3C22 6 22.6 6.1 23 6.5c0.1 0.1 0.2 0.3 0.3 0.4 0.1 0.4 0.1 0.7 0 1.1 -0.1 0.3-0.4 0.6-0.8 0.8 -0.4 0.1-0.7 0.1-1.1 0 -0.2-0.1-0.3-0.2-0.4-0.3 -0.1-0.1-0.2-0.3-0.3-0.4C20.6 7.9 20.6 7.7 20.6 7.5"/><polygon points="41.8 6.8 41.8 9.1 33.5 9.1 33.5 11.5 42.2 11.5 42.2 13.9 30.7 13.9 30.7 2.1 42.1 2.1 42.1 4.5 33.5 4.5 33.5 6.8 "/><path d="M49.4 7.5c0-0.2 0-0.4 0.1-0.5 0.1-0.2 0.2-0.3 0.3-0.4 0.1-0.1 0.3-0.2 0.5-0.3 0.5-0.2 1.1-0.1 1.5 0.3C51.9 6.7 52 6.8 52.1 7c0.1 0.4 0.1 0.7 0 1.1 -0.1 0.3-0.4 0.6-0.8 0.8C51 9 50.6 9 50.2 8.8c-0.2-0.1-0.3-0.2-0.5-0.3 -0.1-0.1-0.2-0.3-0.3-0.4C49.4 7.9 49.4 7.7 49.4 7.5M59.5 13.9V2.1h7.7c0.7 0 1.4 0.1 2.1 0.3 0.5 0.2 1 0.5 1.4 0.9 0.4 0.4 0.7 0.8 0.8 1.3 0.2 0.5 0.3 1 0.3 1.5 0 0.8-0.2 1.5-0.6 2.1 -0.5 0.6-1.1 1-1.8 1.2l2.6 4.4h-3l-2.3-4h-4.4v4H59.5zM62.3 4.5v3.2h5c0.3 0 0.6 0 0.9-0.1 0.2-0.1 0.4-0.2 0.6-0.3 0.1-0.1 0.2-0.3 0.3-0.5 0.1-0.4 0.1-0.8 0-1.2 -0.1-0.2-0.2-0.4-0.3-0.5 -0.2-0.2-0.4-0.3-0.6-0.3 -0.3-0.1-0.6-0.1-0.9-0.1L62.3 4.5 62.3 4.5zM79 7.5c0-0.2 0-0.4 0.1-0.5 0.1-0.2 0.2-0.3 0.3-0.4 0.1-0.1 0.3-0.2 0.4-0.3 0.7-0.3 1.6 0 1.9 0.8 0.3 0.7 0 1.6-0.8 1.9 -0.4 0.1-0.7 0.1-1.1 0 -0.2-0.1-0.3-0.2-0.4-0.3 -0.1-0.1-0.2-0.3-0.3-0.4C79 7.9 79 7.7 79 7.5M89.1 13.9V2.1h7.7c0.7 0 1.4 0.1 2.1 0.3 0.5 0.2 1 0.5 1.4 0.9 0.4 0.4 0.7 0.8 0.8 1.3 0.2 0.5 0.3 1 0.3 1.5 0 0.8-0.2 1.5-0.6 2.1 -0.5 0.6-1.1 1-1.8 1.2l2.6 4.4h-3l-2.3-4h-4.4v4C91.8 13.9 89.1 13.9 89.1 13.9zM91.8 4.5v3.2h5c0.3 0 0.6 0 0.9-0.1 0.2-0.1 0.4-0.2 0.6-0.3 0.1-0.1 0.2-0.3 0.3-0.5 0.1-0.4 0.1-0.8 0-1.2 -0.1-0.2-0.2-0.4-0.3-0.5 -0.2-0.2-0.4-0.3-0.6-0.3 -0.3-0.1-0.6-0.1-0.9-0.1L91.8 4.5 91.8 4.5zM108.5 7.5c0-0.2 0-0.4 0.1-0.5 0.1-0.2 0.2-0.3 0.3-0.4 0.6-0.6 1.5-0.5 2 0 0.1 0.1 0.2 0.3 0.3 0.4 0.1 0.4 0.1 0.7 0 1.1 -0.3 0.7-1.1 1.1-1.9 0.7 -0.2-0.1-0.3-0.2-0.4-0.3 -0.1-0.1-0.2-0.3-0.3-0.4C108.6 7.9 108.5 7.7 108.5 7.5M128.8 11.6h-6.7l-1.2 2.3H118l6.3-11.7h2.2l6.4 11.7H130L128.8 11.6zM123.3 9.3h4.2l-2.1-3.9L123.3 9.3zM139.5 7.5c0-0.2 0-0.4 0.1-0.5 0.1-0.2 0.2-0.3 0.3-0.4 0.4-0.4 1-0.5 1.6-0.3 0.2 0.1 0.3 0.2 0.4 0.3 0.1 0.1 0.2 0.3 0.3 0.4 0.1 0.4 0.1 0.7 0 1.1 -0.1 0.2-0.2 0.3-0.3 0.4 -0.4 0.4-1 0.5-1.6 0.3 -0.2-0.1-0.3-0.2-0.4-0.3 -0.1-0.1-0.2-0.3-0.3-0.4C139.5 7.9 139.5 7.7 139.5 7.5M149.6 13.9V2.1h7.5c0.5 0 1.1 0 1.6 0.1 0.4 0.1 0.8 0.2 1.2 0.3 0.3 0.1 0.6 0.3 0.8 0.5 0.2 0.2 0.4 0.4 0.5 0.6 0.1 0.2 0.2 0.5 0.3 0.7 0 0.3 0.1 0.5 0.1 0.8 0 0.3 0 0.6-0.1 0.9 -0.1 0.3-0.2 0.5-0.4 0.7 -0.2 0.2-0.4 0.4-0.6 0.5 -0.2 0.1-0.5 0.3-0.8 0.3 0.6 0.1 1.2 0.4 1.7 0.9 0.4 0.5 0.6 1.1 0.6 1.7 0 0.3 0 0.6-0.1 0.8 -0.1 0.3-0.2 0.6-0.3 0.8 -0.2 0.3-0.3 0.5-0.6 0.7 -0.3 0.2-0.6 0.4-0.9 0.6 -0.4 0.2-0.8 0.3-1.2 0.4 -0.5 0.1-1.1 0.2-1.6 0.1L149.6 13.9 149.6 13.9zM157.2 6.7c0.3 0 0.5 0 0.8-0.1 0.2 0 0.4-0.1 0.5-0.2 0.1-0.1 0.2-0.2 0.3-0.4 0.1-0.1 0.1-0.3 0.1-0.5 0-0.2 0-0.3-0.1-0.5 -0.1-0.1-0.1-0.3-0.3-0.4 -0.1-0.1-0.3-0.2-0.5-0.2 -0.3-0.1-0.5-0.1-0.8-0.1h-4.8v2.4H157.2L157.2 6.7zM157.2 11.6c0.3 0 0.7 0 1-0.1 0.2 0 0.4-0.1 0.6-0.2 0.1-0.1 0.3-0.2 0.3-0.4 0.1-0.4 0.1-0.8 0-1.1 -0.1-0.2-0.2-0.3-0.3-0.4 -0.2-0.1-0.4-0.2-0.6-0.3 -0.3-0.1-0.7-0.1-1-0.1h-4.8v2.6L157.2 11.6 157.2 11.6zM169 7.5c0-0.2 0-0.4 0.1-0.5 0.1-0.2 0.2-0.3 0.3-0.4 0.1-0.1 0.3-0.2 0.4-0.3 0.5-0.2 1.1-0.1 1.6 0.3 0.1 0.1 0.2 0.3 0.3 0.4 0.1 0.4 0.1 0.7 0 1.1 -0.1 0.3-0.4 0.6-0.8 0.8 -0.4 0.1-0.7 0.1-1.1 0 -0.2-0.1-0.3-0.2-0.4-0.3 -0.1-0.1-0.2-0.3-0.3-0.4C169 7.9 169 7.7 169 7.5"/><rect x="179.1" y="2.1" width="2.7" height="11.7"/><path d="M189.2 7.5c0-0.2 0-0.4 0.1-0.5 0.1-0.2 0.2-0.3 0.3-0.4 0.1-0.1 0.3-0.2 0.4-0.3 0.7-0.2 1.5 0.2 1.8 0.9s-0.2 1.5-0.9 1.8c-0.1 0-0.2 0-0.3 0.1 -0.2 0-0.4 0-0.6-0.1 -0.2-0.1-0.3-0.2-0.4-0.3 -0.1-0.1-0.2-0.3-0.3-0.4C189.2 8 189.2 7.8 189.2 7.5"/><polygon points="211.7 2.1 211.7 4.5 206.6 4.5 206.6 13.9 203.9 13.9 203.9 4.5 198.9 4.5 198.9 2.1 "/><path d="M218.5 7.5c0-0.2 0-0.4 0.1-0.5 0.1-0.2 0.2-0.3 0.3-0.4 0.4-0.4 1-0.5 1.6-0.3 0.2 0.1 0.3 0.2 0.4 0.3 0.1 0.1 0.2 0.3 0.3 0.4 0.1 0.4 0.1 0.7 0 1.1 -0.1 0.2-0.2 0.3-0.3 0.4 -0.4 0.4-1 0.5-1.6 0.3 -0.2-0.1-0.3-0.2-0.4-0.3 -0.1-0.1-0.2-0.3-0.3-0.4C218.5 7.9 218.5 7.7 218.5 7.5"/><polygon points="239.7 6.8 239.7 9.1 231.4 9.1 231.4 11.5 240.1 11.5 240.1 13.9 228.6 13.9 228.6 2.1 240.1 2.1 240.1 4.5 231.4 4.5 231.4 6.8 "/><path d="M247.3 7.5c0-0.2 0-0.4 0.1-0.5 0.1-0.2 0.2-0.3 0.3-0.4 0.1-0.1 0.3-0.2 0.4-0.3 0.7-0.3 1.5 0 1.9 0.7 0.2 0.5 0.1 1.2-0.3 1.6 -0.4 0.4-1 0.5-1.6 0.3 -0.2-0.1-0.3-0.2-0.4-0.3 -0.1-0.1-0.2-0.3-0.3-0.4C247.3 7.9 247.3 7.7 247.3 7.5M267.4 4.9c-0.4-0.2-0.8-0.3-1.1-0.4 -0.4-0.1-0.8-0.2-1.4-0.3 -0.6-0.1-1.2-0.1-1.8-0.1 -0.4 0-0.9 0-1.3 0.1 -0.3 0-0.6 0.1-0.9 0.2 -0.2 0.1-0.4 0.2-0.5 0.3 -0.1 0.1-0.2 0.3-0.2 0.5 0 0.2 0.1 0.4 0.2 0.5 0.2 0.2 0.4 0.3 0.6 0.4 0.3 0.1 0.7 0.2 1 0.3l1.4 0.3c0.9 0.2 1.8 0.4 2.5 0.6 0.6 0.2 1.2 0.4 1.8 0.8 0.4 0.2 0.8 0.6 1 1 0.2 0.4 0.4 0.9 0.3 1.4 0 0.5-0.1 1.1-0.4 1.6 -0.3 0.5-0.7 0.9-1.2 1.1 -0.6 0.3-1.2 0.6-1.9 0.7 -0.8 0.2-1.7 0.2-2.5 0.2 -0.5 0-1 0-1.5-0.1s-0.8-0.1-1.2-0.1 -0.7-0.1-1-0.2 -0.6-0.2-0.9-0.3c-0.5-0.2-1-0.4-1.5-0.7l1.3-1.9c0.4 0.2 0.8 0.4 1.3 0.5 0.5 0.1 1 0.2 1.5 0.3 0.7 0.1 1.3 0.2 2 0.1 0.8 0 1.7-0.1 2.5-0.3 0.4-0.1 0.8-0.5 0.8-0.9 0-0.2 0-0.3-0.2-0.5 -0.2-0.2-0.3-0.3-0.6-0.3 -0.3-0.1-0.7-0.2-1-0.3L263 9.2c-0.9-0.2-1.7-0.4-2.6-0.7 -0.6-0.2-1.2-0.5-1.7-0.8 -0.4-0.3-0.7-0.6-0.9-1 -0.2-0.4-0.3-0.9-0.3-1.3 0-0.4 0.1-0.9 0.3-1.3 0.2-0.4 0.5-0.8 0.9-1.1 0.5-0.4 1.1-0.6 1.7-0.8 0.8-0.2 1.7-0.3 2.5-0.3 0.9 0 1.7 0.1 2.6 0.2 0.6 0.1 1.2 0.2 1.8 0.4 0.5 0.1 0.9 0.3 1.3 0.6L267.4 4.9z"/></svg>' +
      '</div>' +
      '</div>' +
      '</div>'
    );

    // find hex color, add inline style
    $layers.find('.revealer__layer').css({'backgroundColor':'#E3D9BF'});

    jQuery('body').append($layers);
    return jQuery(this.oldContainer).animate({ opacity: 0 }).promise();
  }
});

var BackTransition = this.FadeTransition.extend({
  fadeOut: function() {
    /**
     * this.oldContainer is the HTMLElement of the old Container
     */
    var $layers = jQuery('' +
      '<div class="js-revealer anim--effect-1">' +
      '<div class="revealer revealer--bottom revealer--animate">' +
      '<div class="revealer__layer">' +
      '<svg class="revealer__svg" version="1.1" xmlns="http://www.w3.org/2000/svg" x="0" y="0" viewBox="0 0 270 16" xml:space="preserve"><polygon points="13.7 2.1 13.7 4.5 8.7 4.5 8.7 13.9 6 13.9 6 4.5 1 4.5 1 2.1 "/><path d="M20.6 7.5c0-0.2 0-0.4 0.1-0.5 0.1-0.2 0.2-0.3 0.3-0.5 0.1-0.1 0.3-0.2 0.5-0.3C22 6 22.6 6.1 23 6.5c0.1 0.1 0.2 0.3 0.3 0.4 0.1 0.4 0.1 0.7 0 1.1 -0.1 0.3-0.4 0.6-0.8 0.8 -0.4 0.1-0.7 0.1-1.1 0 -0.2-0.1-0.3-0.2-0.4-0.3 -0.1-0.1-0.2-0.3-0.3-0.4C20.6 7.9 20.6 7.7 20.6 7.5"/><polygon points="41.8 6.8 41.8 9.1 33.5 9.1 33.5 11.5 42.2 11.5 42.2 13.9 30.7 13.9 30.7 2.1 42.1 2.1 42.1 4.5 33.5 4.5 33.5 6.8 "/><path d="M49.4 7.5c0-0.2 0-0.4 0.1-0.5 0.1-0.2 0.2-0.3 0.3-0.4 0.1-0.1 0.3-0.2 0.5-0.3 0.5-0.2 1.1-0.1 1.5 0.3C51.9 6.7 52 6.8 52.1 7c0.1 0.4 0.1 0.7 0 1.1 -0.1 0.3-0.4 0.6-0.8 0.8C51 9 50.6 9 50.2 8.8c-0.2-0.1-0.3-0.2-0.5-0.3 -0.1-0.1-0.2-0.3-0.3-0.4C49.4 7.9 49.4 7.7 49.4 7.5M59.5 13.9V2.1h7.7c0.7 0 1.4 0.1 2.1 0.3 0.5 0.2 1 0.5 1.4 0.9 0.4 0.4 0.7 0.8 0.8 1.3 0.2 0.5 0.3 1 0.3 1.5 0 0.8-0.2 1.5-0.6 2.1 -0.5 0.6-1.1 1-1.8 1.2l2.6 4.4h-3l-2.3-4h-4.4v4H59.5zM62.3 4.5v3.2h5c0.3 0 0.6 0 0.9-0.1 0.2-0.1 0.4-0.2 0.6-0.3 0.1-0.1 0.2-0.3 0.3-0.5 0.1-0.4 0.1-0.8 0-1.2 -0.1-0.2-0.2-0.4-0.3-0.5 -0.2-0.2-0.4-0.3-0.6-0.3 -0.3-0.1-0.6-0.1-0.9-0.1L62.3 4.5 62.3 4.5zM79 7.5c0-0.2 0-0.4 0.1-0.5 0.1-0.2 0.2-0.3 0.3-0.4 0.1-0.1 0.3-0.2 0.4-0.3 0.7-0.3 1.6 0 1.9 0.8 0.3 0.7 0 1.6-0.8 1.9 -0.4 0.1-0.7 0.1-1.1 0 -0.2-0.1-0.3-0.2-0.4-0.3 -0.1-0.1-0.2-0.3-0.3-0.4C79 7.9 79 7.7 79 7.5M89.1 13.9V2.1h7.7c0.7 0 1.4 0.1 2.1 0.3 0.5 0.2 1 0.5 1.4 0.9 0.4 0.4 0.7 0.8 0.8 1.3 0.2 0.5 0.3 1 0.3 1.5 0 0.8-0.2 1.5-0.6 2.1 -0.5 0.6-1.1 1-1.8 1.2l2.6 4.4h-3l-2.3-4h-4.4v4C91.8 13.9 89.1 13.9 89.1 13.9zM91.8 4.5v3.2h5c0.3 0 0.6 0 0.9-0.1 0.2-0.1 0.4-0.2 0.6-0.3 0.1-0.1 0.2-0.3 0.3-0.5 0.1-0.4 0.1-0.8 0-1.2 -0.1-0.2-0.2-0.4-0.3-0.5 -0.2-0.2-0.4-0.3-0.6-0.3 -0.3-0.1-0.6-0.1-0.9-0.1L91.8 4.5 91.8 4.5zM108.5 7.5c0-0.2 0-0.4 0.1-0.5 0.1-0.2 0.2-0.3 0.3-0.4 0.6-0.6 1.5-0.5 2 0 0.1 0.1 0.2 0.3 0.3 0.4 0.1 0.4 0.1 0.7 0 1.1 -0.3 0.7-1.1 1.1-1.9 0.7 -0.2-0.1-0.3-0.2-0.4-0.3 -0.1-0.1-0.2-0.3-0.3-0.4C108.6 7.9 108.5 7.7 108.5 7.5M128.8 11.6h-6.7l-1.2 2.3H118l6.3-11.7h2.2l6.4 11.7H130L128.8 11.6zM123.3 9.3h4.2l-2.1-3.9L123.3 9.3zM139.5 7.5c0-0.2 0-0.4 0.1-0.5 0.1-0.2 0.2-0.3 0.3-0.4 0.4-0.4 1-0.5 1.6-0.3 0.2 0.1 0.3 0.2 0.4 0.3 0.1 0.1 0.2 0.3 0.3 0.4 0.1 0.4 0.1 0.7 0 1.1 -0.1 0.2-0.2 0.3-0.3 0.4 -0.4 0.4-1 0.5-1.6 0.3 -0.2-0.1-0.3-0.2-0.4-0.3 -0.1-0.1-0.2-0.3-0.3-0.4C139.5 7.9 139.5 7.7 139.5 7.5M149.6 13.9V2.1h7.5c0.5 0 1.1 0 1.6 0.1 0.4 0.1 0.8 0.2 1.2 0.3 0.3 0.1 0.6 0.3 0.8 0.5 0.2 0.2 0.4 0.4 0.5 0.6 0.1 0.2 0.2 0.5 0.3 0.7 0 0.3 0.1 0.5 0.1 0.8 0 0.3 0 0.6-0.1 0.9 -0.1 0.3-0.2 0.5-0.4 0.7 -0.2 0.2-0.4 0.4-0.6 0.5 -0.2 0.1-0.5 0.3-0.8 0.3 0.6 0.1 1.2 0.4 1.7 0.9 0.4 0.5 0.6 1.1 0.6 1.7 0 0.3 0 0.6-0.1 0.8 -0.1 0.3-0.2 0.6-0.3 0.8 -0.2 0.3-0.3 0.5-0.6 0.7 -0.3 0.2-0.6 0.4-0.9 0.6 -0.4 0.2-0.8 0.3-1.2 0.4 -0.5 0.1-1.1 0.2-1.6 0.1L149.6 13.9 149.6 13.9zM157.2 6.7c0.3 0 0.5 0 0.8-0.1 0.2 0 0.4-0.1 0.5-0.2 0.1-0.1 0.2-0.2 0.3-0.4 0.1-0.1 0.1-0.3 0.1-0.5 0-0.2 0-0.3-0.1-0.5 -0.1-0.1-0.1-0.3-0.3-0.4 -0.1-0.1-0.3-0.2-0.5-0.2 -0.3-0.1-0.5-0.1-0.8-0.1h-4.8v2.4H157.2L157.2 6.7zM157.2 11.6c0.3 0 0.7 0 1-0.1 0.2 0 0.4-0.1 0.6-0.2 0.1-0.1 0.3-0.2 0.3-0.4 0.1-0.4 0.1-0.8 0-1.1 -0.1-0.2-0.2-0.3-0.3-0.4 -0.2-0.1-0.4-0.2-0.6-0.3 -0.3-0.1-0.7-0.1-1-0.1h-4.8v2.6L157.2 11.6 157.2 11.6zM169 7.5c0-0.2 0-0.4 0.1-0.5 0.1-0.2 0.2-0.3 0.3-0.4 0.1-0.1 0.3-0.2 0.4-0.3 0.5-0.2 1.1-0.1 1.6 0.3 0.1 0.1 0.2 0.3 0.3 0.4 0.1 0.4 0.1 0.7 0 1.1 -0.1 0.3-0.4 0.6-0.8 0.8 -0.4 0.1-0.7 0.1-1.1 0 -0.2-0.1-0.3-0.2-0.4-0.3 -0.1-0.1-0.2-0.3-0.3-0.4C169 7.9 169 7.7 169 7.5"/><rect x="179.1" y="2.1" width="2.7" height="11.7"/><path d="M189.2 7.5c0-0.2 0-0.4 0.1-0.5 0.1-0.2 0.2-0.3 0.3-0.4 0.1-0.1 0.3-0.2 0.4-0.3 0.7-0.2 1.5 0.2 1.8 0.9s-0.2 1.5-0.9 1.8c-0.1 0-0.2 0-0.3 0.1 -0.2 0-0.4 0-0.6-0.1 -0.2-0.1-0.3-0.2-0.4-0.3 -0.1-0.1-0.2-0.3-0.3-0.4C189.2 8 189.2 7.8 189.2 7.5"/><polygon points="211.7 2.1 211.7 4.5 206.6 4.5 206.6 13.9 203.9 13.9 203.9 4.5 198.9 4.5 198.9 2.1 "/><path d="M218.5 7.5c0-0.2 0-0.4 0.1-0.5 0.1-0.2 0.2-0.3 0.3-0.4 0.4-0.4 1-0.5 1.6-0.3 0.2 0.1 0.3 0.2 0.4 0.3 0.1 0.1 0.2 0.3 0.3 0.4 0.1 0.4 0.1 0.7 0 1.1 -0.1 0.2-0.2 0.3-0.3 0.4 -0.4 0.4-1 0.5-1.6 0.3 -0.2-0.1-0.3-0.2-0.4-0.3 -0.1-0.1-0.2-0.3-0.3-0.4C218.5 7.9 218.5 7.7 218.5 7.5"/><polygon points="239.7 6.8 239.7 9.1 231.4 9.1 231.4 11.5 240.1 11.5 240.1 13.9 228.6 13.9 228.6 2.1 240.1 2.1 240.1 4.5 231.4 4.5 231.4 6.8 "/><path d="M247.3 7.5c0-0.2 0-0.4 0.1-0.5 0.1-0.2 0.2-0.3 0.3-0.4 0.1-0.1 0.3-0.2 0.4-0.3 0.7-0.3 1.5 0 1.9 0.7 0.2 0.5 0.1 1.2-0.3 1.6 -0.4 0.4-1 0.5-1.6 0.3 -0.2-0.1-0.3-0.2-0.4-0.3 -0.1-0.1-0.2-0.3-0.3-0.4C247.3 7.9 247.3 7.7 247.3 7.5M267.4 4.9c-0.4-0.2-0.8-0.3-1.1-0.4 -0.4-0.1-0.8-0.2-1.4-0.3 -0.6-0.1-1.2-0.1-1.8-0.1 -0.4 0-0.9 0-1.3 0.1 -0.3 0-0.6 0.1-0.9 0.2 -0.2 0.1-0.4 0.2-0.5 0.3 -0.1 0.1-0.2 0.3-0.2 0.5 0 0.2 0.1 0.4 0.2 0.5 0.2 0.2 0.4 0.3 0.6 0.4 0.3 0.1 0.7 0.2 1 0.3l1.4 0.3c0.9 0.2 1.8 0.4 2.5 0.6 0.6 0.2 1.2 0.4 1.8 0.8 0.4 0.2 0.8 0.6 1 1 0.2 0.4 0.4 0.9 0.3 1.4 0 0.5-0.1 1.1-0.4 1.6 -0.3 0.5-0.7 0.9-1.2 1.1 -0.6 0.3-1.2 0.6-1.9 0.7 -0.8 0.2-1.7 0.2-2.5 0.2 -0.5 0-1 0-1.5-0.1s-0.8-0.1-1.2-0.1 -0.7-0.1-1-0.2 -0.6-0.2-0.9-0.3c-0.5-0.2-1-0.4-1.5-0.7l1.3-1.9c0.4 0.2 0.8 0.4 1.3 0.5 0.5 0.1 1 0.2 1.5 0.3 0.7 0.1 1.3 0.2 2 0.1 0.8 0 1.7-0.1 2.5-0.3 0.4-0.1 0.8-0.5 0.8-0.9 0-0.2 0-0.3-0.2-0.5 -0.2-0.2-0.3-0.3-0.6-0.3 -0.3-0.1-0.7-0.2-1-0.3L263 9.2c-0.9-0.2-1.7-0.4-2.6-0.7 -0.6-0.2-1.2-0.5-1.7-0.8 -0.4-0.3-0.7-0.6-0.9-1 -0.2-0.4-0.3-0.9-0.3-1.3 0-0.4 0.1-0.9 0.3-1.3 0.2-0.4 0.5-0.8 0.9-1.1 0.5-0.4 1.1-0.6 1.7-0.8 0.8-0.2 1.7-0.3 2.5-0.3 0.9 0 1.7 0.1 2.6 0.2 0.6 0.1 1.2 0.2 1.8 0.4 0.5 0.1 0.9 0.3 1.3 0.6L267.4 4.9z"/></svg>' +
      '</div>' +
      '</div>' +
      '</div>'
    );

    // find hex color, add inline style
    var hexColorElement = jQuery(this.oldContainer).find('.js-hex');
    var currentUrl = Barba.HistoryManager.prevStatus().url;
    var base_path =
      window.location.protocol + '//' +
      window.location.host + '/';

    var hexColor = 'E3D9BF';
    if(currentUrl === base_path) {
      var targetUrl = Barba.HistoryManager.currentStatus().url.split('/');
      targetUrl = targetUrl[targetUrl.length - 1];
      var link = jQuery(this.oldContainer).find('.js-fullpage-link[href="/' + targetUrl + '"]');
      hexColor = link.data('hex-color');
      if(hexColor !== 'E3D9BF') {
        $layers.find('.revealer').addClass('revealer--light');
      }
      $layers.find('.revealer__layer').css({'backgroundColor':'#'+hexColor});
    }

    else if(hexColorElement.length) {
      hexColor = hexColorElement.data('hex-color');
      if(hexColor !== 'E3D9BF') {
        $layers.find('.revealer').addClass('revealer--light');
      }
      $layers.find('.revealer__layer').css({'backgroundColor':'#'+hexColor});
    }

    jQuery('body').append($layers);
    return jQuery(this.oldContainer).animate({ opacity: 0 }).promise();
  }
});

/**
 * Next step, you have to tell Barba to use the new Transition
 */
Barba.Pjax.getTransition = function() {
  /**
   * Here you can use your own logic!
   * For example you can use different Transition based on the current page or link...
   */
  var base_path =
    window.location.protocol + '//' +
    window.location.host + '/';

  // Target url.
  var targetUrl = Barba.HistoryManager.currentStatus().url;
  // Current Url.
  var currentUrl = Barba.HistoryManager.prevStatus().url;
  // Prev url.
  var prevUrl = null;
  if (Barba.HistoryManager.history.length < 3) {
    prevUrl = null;
  }
  else {
    prevUrl = Barba.HistoryManager.history[Barba.HistoryManager.history.length - 3].url;
  }

  if(targetUrl === base_path) {
    return popping ? BackTransition : FrontTransition;
  }
  // return FadeTransition;
  return popping ? BackTransition : FadeTransition;
  // return BackTransition;
};


// Toggle drupal menu item active state.
Barba.Dispatcher.on('linkClicked', function(element, event) {
  // if (jQuery(element).hasClass('side-menu__link')) {
  //   jQuery('.side-menu__item a').removeClass('is-active').parent().removeClass('menu-item--active-trail')
  //   jQuery(element).addClass('is-active')
  // }
});


Barba.Dispatcher.on('newPageReady', function(currentStatus, prevStatus, HTMLElementContainer, newPageRawHTML) {
  var regexp = /\<body.*\sclass=["'](.+?)["'].*\>/gi,
      match = regexp.exec(newPageRawHTML);
  if(!match || !match[1]) return;
  document.body.setAttribute('class', match[1]);

  if (!jQuery.isEmptyObject(prevStatus)) {
    //Drupal.attachBehaviors(HTMLElementContainer);
  }
});


/**
 * Attach Drupal Behaviors when the transition has completed.
 */
Barba.Dispatcher.on('transitionCompleted', function(currentStatus, prevStatus) {

});


// Prevent Barba on links that contain admin, edit & delete.
Barba.Pjax.originalPreventCheck = Barba.Pjax.preventCheck;
Barba.Pjax.preventCheck = function(evt, element) {
  if (
    element &&
    element.getAttribute('href') &&
    element.getAttribute('href').indexOf('#') > -1
  ) {
    if(window.location.pathname === '/') {
      return false;
    }
    return true;
  }

  if (!Barba.Pjax.originalPreventCheck(evt, element)) {
    return false;
  }

  // No need to check for element.href -
  // originalPreventCheck does this for us! (and more!)
  if (/admin|edit|delete/.test(element.href.toLowerCase())) {
    return false;
  }

  return true;
};

Barba.Dispatcher.on('initStateChange', function() {
  popping = false;
});

document.addEventListener("DOMContentLoaded", function(event) {
  // Do not run on zen theme.
  if (!jQuery('body').hasClass('theme-pb')) {
    return;
  }

  // Set the id of wrapper & the container.
  Barba.Pjax.Dom.wrapperId = 'barba-wrapper';
  Barba.Pjax.Dom.containerClass = 'barba-container';

  Barba.Prefetch.init();
  Barba.Pjax.start();
});

Drupal.behaviors.barbaSettings = {};
